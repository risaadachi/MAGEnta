<div class="container">

    <h1>Codes</h1>

    <%= render 'codes/show', code: @code %>


    <!-- PV -->
    <%= @code.impressionist_count %>
    <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>

<!-- Get the unique impression count from a model filtered by session hash. Same as #6 regarding request hash. This may be more desirable than filtering by IP address depending on your situation, since filtering by IP may ignore visitors that use the same IP. The downside to this filtering is that a user could clear session data in their browser and skew the results.
↑READMEより。
ユーザが見た分増える。リロード、いいね、コメントしても増えない。 -->

<!-- いいね -->
<% if user_signed_in? %>
<% if @code.favorited_by?(current_user) %>
<%= link_to code_favorites_path(@code), method: :delete, class: "fav" do %>
<i class="fa fa-heart" aria-hidden="true"></i>
<span class="favorites_count"><%= @code.favorites.count %>
    <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
</span>
<% end %>

<% else %>
<%= link_to code_favorites_path(@code), method: :post, class: "fav" do %>
<i class="fa fa-heart-o" aria-hidden="true"></i>
<span class="favorites_count"><%= @code.favorites.count %>
    <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
</span>
<% end %>
<% end %>

<% else %>
<%= link_to new_user_session_path, class: "fav" do %>
<i class="fa fa-heart-o" aria-hidden="true"></i>
<span class="favorites_count"><%= @code.favorites.count %>
    <span class="glyphicon glyphicon-heart" aria-hidden="true"></span>
</span>
<% end %>
<% end %>

<!-- コメント -->

<%= @code.comments.count %>
<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
<br>
<%= form_for [@code, @comment] do |f| %>
<%= f.text_area :body, placeholder: "Comment!!", class: "btn btn-default col-xs-3" %><br>
<%= f.submit 'Submit', class: "btn btn-default col-xs-3" %><br>
<% end %>

<div class="table-scroll">
    <%= render 'comments/index', comments: @comments, code: @code %><br>
</div>

</div>
